receivers:
  oxideauditlogs:
    collection_interval: 60s
    initial_lookback: 24h
    cursor_path: /var/lib/otelcol/audit_cursor.json

  oxide:
    # Note: uncomment to configure Oxide API authentication. By default, the
    # collector uses the $OXIDE_{PROFILE,HOST,TOKEN} environment variables.
    # host: ${env:OXIDE_HOST}
    # token: ${env:OXIDE_TOKEN}
    metric_patterns:
    - virtual_machine:.*
    - virtual_disk:.*
    - hardware_component:.*
    add_labels: true
    add_utilization_metrics: true
    collection_interval: 60s

processors:
  batch:
  # Keep log batches small to stay within Loki's request size limit.
  batch/logs:
    send_batch_size: 1000
    send_batch_max_size: 1000

exporters:
  otlp_http/loki:
    endpoint: http://loki:3100/otlp
    tls:
      insecure: true

  prometheus:
    endpoint: "0.0.0.0:9091"
    translation_strategy: UnderscoreEscapingWithSuffixes
    resource_to_telemetry_conversion:
      enabled: true

service:
  telemetry:
    metrics:
      level: detailed
      readers:
      - pull:
          exporter:
            prometheus:
              host: 0.0.0.0
              port: 8888

  pipelines:
    metrics:
      receivers: [oxide]
      processors: [batch]
      exporters: [prometheus]

    logs:
      receivers: [oxideauditlogs]
      processors: [batch/logs]
      exporters: [otlp_http/loki]
